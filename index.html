<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>‰∏πÈÅìËßÄÂ§©</title>

  <!-- FaviconÔºàÂèØËá™Ë°åÊõøÊèõÔºâ -->
  <link rel="icon" type="image/png" href="./icon-v2.png">
  <link rel="apple-touch-icon" href="./icon-v2.png">
  <link rel="apple-touch-icon" sizes="180x180" href="./icon-v2.png">

  <!-- Â≠óÈ´îÔºöÊÄùÊ∫êÂÆãÈ´î + EB GaramondÔºàÂè§Á±çÊÑüÔºâ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;500;600;700&family=EB+Garamond:wght@400;500;600;700&display=swap"
    rel="stylesheet">

  <style>
    :root {
      --bg-paper: #f7f3e8;
      --bg-paper-deep: #ede2ca;
      --bg-paper-soft: #f2e8d7;
      --ink-main: #2c1b18;
      --ink-muted: #7a5a43;
      --ink-red: #b1442a;
      --ink-blue-deep: #1f3144;
      --accent-gold: #d0a85e;
      --accent-gold-soft: rgba(208, 168, 94, 0.12);
      --border-ink: #b19b7a;
      --shadow-soft: 0 18px 45px rgba(68, 32, 11, 0.25);
      --radius-card: 24px;
      --radius-pill: 999px;
      --radius-inner: 18px;
      --blur-bg: blur(18px);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
    }

    body {
      font-family: "Noto Serif TC", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top left, rgba(209, 196, 175, 0.9), transparent 60%),
        radial-gradient(circle at bottom right, rgba(162, 120, 82, 0.9), transparent 55%),
        radial-gradient(circle at center, rgba(235, 221, 199, 0.98), rgba(219, 203, 175, 0.98));
      color: var(--ink-main);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 12px;
      overflow-x: hidden;
      overscroll-behavior-y: none;
      position: relative;
      scroll-behavior: smooth;
      background-attachment: fixed;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.35) 0, transparent 45%),
        radial-gradient(circle at 80% 0%, rgba(255, 255, 255, 0.4) 0, transparent 55%),
        radial-gradient(circle at 0% 100%, rgba(255, 255, 255, 0.32) 0, transparent 50%);
      pointer-events: none;
      opacity: 0.95;
      mix-blend-mode: screen;
      z-index: -1;
    }

    .app-shell {
      width: 100%;
      max-width: 480px;
      background: radial-gradient(circle at top, #faf2e2, #f0e0c4 58%, #e2d0af 100%);
      border-radius: 32px;
      box-shadow:
        0 36px 80px rgba(70, 40, 15, 0.55),
        0 0 0 1px rgba(143, 105, 64, 0.55);
      border: 1px solid rgba(210, 175, 120, 0.7);
      overflow: hidden;
      position: relative;
      backdrop-filter: blur(20px);
    }

    .app-shell::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        url("https://images.pexels.com/photos/2698109/pexels-photo-2698109.jpeg?auto=compress&cs=tinysrgb&w=1200"),
        radial-gradient(circle at top, rgba(255, 255, 255, 0.85), rgba(242, 229, 207, 0.98));
      background-size: cover, cover;
      background-position: center;
      mix-blend-mode: soft-light;
      opacity: 0.35;
      pointer-events: none;
      filter: saturate(0.9);
    }

    .app-shell::after {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(circle at top left, rgba(255, 255, 255, 0.22) 0, transparent 55%),
        radial-gradient(circle at bottom right, rgba(118, 87, 52, 0.28) 0, transparent 60%);
      mix-blend-mode: screen;
      opacity: 0.8;
      pointer-events: none;
    }

    .app-inner {
      position: relative;
      z-index: 1;
      padding: 18px 18px 20px;
      min-height: 100vh;
    }

    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 4px 10px;
      margin-bottom: 6px;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .app-title-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .title-mark {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #f7e9cf, #d9b788 55%, #af7d4a 100%);
      box-shadow:
        0 0 0 1px rgba(80, 48, 26, 0.65),
        0 12px 18px rgba(59, 30, 12, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: "EB Garamond", serif;
      font-size: 22px;
      color: #2b1a12;
      position: relative;
      overflow: hidden;
    }

    .title-mark::before {
      content: "";
      position: absolute;
      inset: 3px;
      border-radius: inherit;
      border: 1px solid rgba(255, 255, 255, 0.65);
      box-shadow: inset 0 0 0 1px rgba(123, 78, 41, 0.3);
    }

    .title-text-main {
      font-size: 24px;
      letter-spacing: 0.4em;
      text-indent: 0.4em;
      font-weight: 600;
      color: #2a1812;
      text-shadow: 0 1px 0 rgba(255, 255, 255, 0.3);
    }

    .title-sub-row {
      display: flex;
      align-items: baseline;
      gap: 8px;
      padding-left: 2px;
    }

    .title-sub-zh {
      font-size: 13px;
      color: #6c4a34;
      letter-spacing: 0.24em;
      text-indent: 0.24em;
    }

    .title-sub-en {
      font-family: "EB Garamond", serif;
      font-size: 12px;
      color: rgba(52, 31, 17, 0.78);
      letter-spacing: 0.16em;
      text-transform: uppercase;
    }

    .header-meta {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 3px;
      font-size: 11px;
      color: #7a5a43;
    }

    .header-meta .city-tag {
      padding: 3px 10px;
      border-radius: 999px;
      border: 1px solid rgba(152, 118, 78, 0.8);
      background: radial-gradient(circle at top left, #fff8eb, #f0e1c9);
      box-shadow:
        0 3px 7px rgba(91, 55, 26, 0.35),
        inset 0 0 0 1px rgba(255, 255, 255, 0.5);
      display: flex;
      align-items: center;
      gap: 6px;
      letter-spacing: 0.16em;
      text-indent: 0.16em;
      color: #5a3e26;
    }

    .city-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #ffeac1, #d08449);
      box-shadow: 0 0 0 1px rgba(92, 56, 34, 0.6);
    }

    .header-meta .date-line {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .date-label {
      padding: 1px 6px;
      border-radius: 999px;
      background: rgba(151, 111, 68, 0.12);
      color: #5c3b24;
    }

    .date-value {
      font-family: "EB Garamond", serif;
      letter-spacing: 0.08em;
      font-size: 11px;
    }

    .refresh-btn {
      margin-top: 4px;
      padding: 4px 10px;
      border: 1px solid rgba(124, 94, 60, 0.85);
      background: radial-gradient(circle at top, #fff8eb, #f3dfc7);
      box-shadow:
        0 4px 10px rgba(76, 45, 21, 0.45),
        inset 0 0 0 1px rgba(255, 255, 255, 0.7);
      font-family: inherit;
      font-size: 11px;
      border-radius: 999px;
      color: var(--ink-blue-deep);
      letter-spacing: 0.1em;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .refresh-btn::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 50% 50%,
          rgba(177, 68, 42, 0.18),
          transparent 60%);
      opacity: 0;
      transition: opacity 0.25s ease-out;
      mix-blend-mode: soft-light;
    }

    .refresh-btn:active::after {
      opacity: 1;
    }

    .main-content {
      display: none;
      display: flex;
      flex-direction: column;
      gap: 14px;
      margin-top: 4px;
    }

    .hero-card {
      position: relative;
      border-radius: var(--radius-card);
      padding: 14px 16px 16px;
      background:
        radial-gradient(circle at top left, rgba(255, 255, 255, 0.96), rgba(245, 229, 206, 0.98)),
        linear-gradient(135deg, rgba(212, 186, 145, 0.85), rgba(165, 130, 93, 0.85));
      box-shadow:
        0 16px 32px rgba(68, 36, 14, 0.55),
        0 0 0 1px rgba(150, 113, 77, 0.6);
      overflow: hidden;
    }

    .hero-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(circle at top left, rgba(255, 255, 255, 0.55) 0, transparent 55%),
        radial-gradient(circle at bottom right, rgba(144, 90, 50, 0.45) 0, transparent 60%);
      mix-blend-mode: soft-light;
      opacity: 0.95;
      pointer-events: none;
    }

    .hero-inner {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .hero-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .hero-title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .hero-title {
      font-size: 18px;
      letter-spacing: 0.36em;
      text-indent: 0.36em;
      font-weight: 600;
      color: #2b1b14;
    }

    .hero-subtitle {
      font-size: 11px;
      color: #6a4831;
      letter-spacing: 0.14em;
      text-indent: 0.14em;
      font-family: "EB Garamond", serif;
      text-transform: uppercase;
    }

    .hero-meta {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      font-size: 11px;
      color: #6c4734;
    }

    .hero-period-tag {
      padding: 3px 10px;
      border-radius: 999px;
      border: 1px solid rgba(116, 84, 52, 0.9);
      background: radial-gradient(circle at top left, #fff6e8, #f4debd);
      box-shadow:
        0 4px 10px rgba(82, 48, 24, 0.5),
        inset 0 0 0 1px rgba(255, 255, 255, 0.7);
      letter-spacing: 0.2em;
      text-indent: 0.2em;
    }

    .hero-meta-line {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .meta-label {
      padding: 1px 6px;
      border-radius: 999px;
      background: rgba(112, 79, 48, 0.12);
      font-size: 10px;
    }

    .meta-value {
      font-size: 10px;
      opacity: 0.9;
    }

    .hero-main {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .hero-icon-wrap {
      flex-shrink: 0;
      width: 82px;
      height: 82px;
      border-radius: 36px;
      background: radial-gradient(circle at 30% 20%, #fff3d5, #e4ba7f, #b1713d);
      box-shadow:
        0 12px 26px rgba(75, 37, 11, 0.55),
        0 0 0 1px rgba(99, 60, 34, 0.55);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .hero-icon-wrap::before {
      content: "";
      position: absolute;
      inset: 6px;
      border-radius: inherit;
      border: 1px solid rgba(255, 255, 255, 0.8);
      box-shadow: inset 0 0 0 1px rgba(139, 88, 50, 0.4);
    }

    .hero-icon {
      font-size: 48px;
      filter: drop-shadow(0 3px 4px rgba(78, 39, 18, 0.65));
    }

    .hero-temp-block {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
      align-items: flex-start;
    }

    .hero-temp {
      font-size: 40px;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-indent: 0.12em;
      color: #2e1c13;
      text-shadow:
        0 1px 0 rgba(255, 255, 255, 0.6),
        0 3px 8px rgba(77, 36, 16, 0.65);
    }

    .hero-weather-text {
      font-size: 14px;
      color: #5f3d26;
      letter-spacing: 0.2em;
      text-indent: 0.2em;
    }

    .hero-range {
      font-size: 11px;
      color: #7a5434;
    }

    .hero-advice-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 6px;
    }

    .advice-item {
      padding: 8px 10px;
      border-radius: 14px;
      border: 1px solid rgba(141, 104, 66, 0.7);
      background: radial-gradient(circle at top left, #fff9ee, #f4dfc4);
      box-shadow:
        0 6px 14px rgba(87, 51, 25, 0.5),
        inset 0 0 0 1px rgba(255, 255, 255, 0.75);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .advice-title {
      font-size: 11px;
      letter-spacing: 0.3em;
      text-indent: 0.3em;
      color: #5a361e;
    }

    .advice-main {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .advice-icon {
      font-size: 18px;
    }

    .advice-desc {
      font-size: 11px;
      color: #4e301c;
    }

    .advice-sub {
      font-size: 10px;
      color: #7c5435;
      margin-top: 2px;
    }

    .section-wrapper {
      position: relative;
      border-radius: var(--radius-card);
      padding: 12px 13px 13px;
      background:
        radial-gradient(circle at top left, rgba(255, 255, 255, 0.98), rgba(244, 230, 209, 0.98)),
        linear-gradient(135deg, rgba(218, 192, 150, 0.95), rgba(172, 137, 100, 0.95));
      box-shadow:
        0 12px 26px rgba(68, 36, 14, 0.55),
        0 0 0 1px rgba(147, 111, 76, 0.65);
      margin-top: 2px;
      overflow: hidden;
    }

    .section-wrapper::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(circle at top, rgba(255, 255, 255, 0.7) 0, transparent 45%),
        radial-gradient(circle at bottom, rgba(124, 85, 49, 0.4) 0, transparent 65%);
      mix-blend-mode: soft-light;
      pointer-events: none;
      opacity: 0.95;
    }

    .section-inner {
      position: relative;
      z-index: 1;
    }

    .section-heading {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .section-heading-label {
      font-size: 13px;
      letter-spacing: 0.32em;
      text-indent: 0.32em;
      color: #3e2617;
    }

    .section-heading-line {
      flex: 1;
      height: 1px;
      background: linear-gradient(to right,
          rgba(75, 48, 26, 0.7),
          rgba(75, 48, 26, 0));
    }

    .solar-card {
      border-radius: 18px;
      border: 1px solid rgba(135, 99, 63, 0.85);
      background:
        linear-gradient(135deg, rgba(250, 242, 226, 0.98), rgba(239, 222, 199, 0.98)),
        radial-gradient(circle at top left, rgba(255, 255, 255, 0.85), rgba(202, 172, 131, 0.95));
      box-shadow:
        0 10px 22px rgba(70, 38, 14, 0.55),
        inset 0 0 0 1px rgba(255, 255, 255, 0.8);
      padding: 11px 12px 12px;
    }

    .solar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .solar-tag {
      padding: 3px 10px;
      border-radius: 999px;
      border: 1px solid rgba(132, 90, 52, 0.9);
      background: radial-gradient(circle at top left, #fff9eb, #edd4b2);
      font-size: 11px;
      letter-spacing: 0.26em;
      text-indent: 0.26em;
      color: #4a2d18;
      box-shadow:
        0 4px 10px rgba(88, 50, 25, 0.5),
        inset 0 0 0 1px rgba(255, 255, 255, 0.8);
    }

    .solar-stamp {
      border-radius: 999px;
      padding: 3px 12px;
      font-size: 11px;
      letter-spacing: 0.3em;
      text-indent: 0.3em;
      color: #862f1f;
      border: 1px solid rgba(152, 60, 38, 0.9);
      background:
        radial-gradient(circle at 30% 20%, rgba(255, 245, 235, 1), rgba(212, 144, 116, 1));
      box-shadow:
        0 4px 10px rgba(86, 40, 22, 0.65),
        inset 0 0 0 1px rgba(255, 255, 255, 0.85);
    }

    .solar-body {
      display: flex;
      flex-direction: column;
      gap: 5px;
      font-size: 12px;
      color: #4d301e;
    }

    .solar-term-line {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: baseline;
      margin-bottom: 2px;
    }

    .solar-term-name {
      font-size: 18px;
      letter-spacing: 0.2em;
      text-indent: 0.2em;
      font-weight: 600;
      color: #3a2215;
    }

    .solar-term-note {
      font-size: 11px;
      color: #7a5333;
    }

    .solar-diet-main {
      font-size: 12px;
      font-weight: 500;
      margin-top: 2px;
    }

    .solar-diet-sub {
      font-size: 11px;
      color: #6a4a30;
      line-height: 1.5;
      margin-top: 2px;
    }

    .scroll-container {
      display: flex;
      overflow-x: auto;
      gap: 10px;
      padding-bottom: 2px;
      padding-top: 2px;
      scroll-snap-type: x mandatory;
      scrollbar-width: thin;
      scrollbar-color: rgba(121, 83, 48, 0.8) rgba(245, 229, 204, 0.9);
    }

    .scroll-container::-webkit-scrollbar {
      height: 4px;
    }

    .scroll-container::-webkit-scrollbar-track {
      background: rgba(244, 228, 205, 0.9);
      border-radius: 999px;
    }

    .scroll-container::-webkit-scrollbar-thumb {
      background: rgba(117, 79, 44, 0.9);
      border-radius: 999px;
    }

    .mini-card {
      flex: 0 0 120px;
      scroll-snap-align: start;
      border-radius: 16px;
      border: 1px solid rgba(131, 95, 63, 0.9);
      background:
        radial-gradient(circle at top left, rgba(255, 250, 240, 0.98), rgba(238, 220, 196, 0.98)),
        linear-gradient(145deg, rgba(213, 184, 145, 0.95), rgba(165, 131, 96, 0.95));
      box-shadow:
        0 8px 18px rgba(72, 41, 17, 0.6),
        inset 0 0 0 1px rgba(255, 255, 255, 0.85);
      padding: 8px 9px 9px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 11px;
    }

    .mini-time {
      font-size: 11px;
      color: #4d2e20;
      letter-spacing: 0.26em;
      text-indent: 0.26em;
    }

    .mini-icon-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .mini-icon {
      font-size: 20px;
    }

    .mini-temp {
      font-size: 11px;
      color: #6b4329;
    }

    .mini-rain {
      font-size: 10px;
      color: #724830;
    }

    .loading-overlay {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 90px 20px 80px;
      text-align: center;
    }

    .loading-orb {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      background:
        radial-gradient(circle at 30% 20%, #fff5da, #e3bb7e, #b46b38),
        radial-gradient(circle at 70% 80%, rgba(255, 255, 255, 0.9), transparent 50%);
      box-shadow:
        0 18px 35px rgba(76, 38, 12, 0.65),
        0 0 0 1px rgba(95, 58, 32, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      margin-bottom: 18px;
      animation: orbFloat 2.3s ease-in-out infinite;
    }

    .loading-orb::before {
      content: "";
      position: absolute;
      inset: 6px;
      border-radius: inherit;
      border: 1px solid rgba(255, 255, 255, 0.9);
      box-shadow: inset 0 0 0 1px rgba(126, 78, 44, 0.45);
    }

    .loading-orb-inner {
      font-size: 40px;
      filter: drop-shadow(0 4px 6px rgba(83, 46, 22, 0.7));
    }

    .loading-text-main {
      font-size: 16px;
      letter-spacing: 0.24em;
      text-indent: 0.24em;
      margin-bottom: 4px;
      color: #3a2417;
    }

    .loading-text-sub {
      font-size: 12px;
      color: #6a4930;
      line-height: 1.6;
    }

    .loading-hint {
      margin-top: 14px;
      font-size: 11px;
      color: #846043;
    }

    .loading-hint span {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(128, 93, 63, 0.9);
      background: rgba(247, 232, 207, 0.95);
      box-shadow:
        0 4px 10px rgba(89, 54, 28, 0.55),
        inset 0 0 0 1px rgba(255, 255, 255, 0.7);
    }

    @keyframes orbFloat {
      0% {
        transform: translateY(0px);
      }

      50% {
        transform: translateY(-8px);
      }

      100% {
        transform: translateY(0px);
      }
    }

    #errorArea {
      margin-top: 4px;
      margin-bottom: 2px;
      font-size: 12px;
      color: #a33427;
    }

    #errorArea .error-card {
      padding: 8px 10px;
      border-radius: 14px;
      border: 1px solid rgba(157, 65, 48, 0.9);
      background:
        radial-gradient(circle at top left, #fff4ee, #f3c7b6);
      box-shadow:
        0 8px 18px rgba(86, 39, 21, 0.5),
        inset 0 0 0 1px rgba(255, 255, 255, 0.85);
    }

    #errorArea .error-title {
      font-size: 12px;
      letter-spacing: 0.18em;
      text-indent: 0.18em;
      margin-bottom: 4px;
      color: #7b2c20;
    }

    #errorArea .error-body {
      font-size: 11px;
      color: #6a3a2a;
    }

    .app-footer {
      margin-top: 10px;
      padding-top: 6px;
      border-top: 1px dashed rgba(138, 102, 68, 0.6);
      font-size: 10px;
      color: #7c5a3e;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .footer-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .footer-line {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .footer-dot {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: #8b5f3b;
    }

    .footer-label {
      letter-spacing: 0.16em;
      text-indent: 0.16em;
    }

    .footer-source {
      font-size: 10px;
      opacity: 0.9;
    }

    .footer-right {
      font-family: "EB Garamond", serif;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .footer-tn {
      font-size: 11px;
    }

    .footer-en {
      font-size: 10px;
      opacity: 0.9;
    }

    @media (max-width: 480px) {
      body {
        padding: 8px;
      }

      .app-shell {
        border-radius: 28px;
      }

      .hero-main {
        align-items: center;
      }

      .hero-temp {
        font-size: 34px;
      }
    }

    @media (max-width: 360px) {
      .hero-main {
        flex-direction: column;
        align-items: flex-start;
      }

      .hero-icon-wrap {
        width: 76px;
        height: 76px;
      }
    }
  </style>
</head>

<body>
  <main class="app-shell">
    <div class="app-inner">
      <header class="app-header">
        <div class="title-block">
          <div class="app-title-row">
            <div class="title-mark">
              ‰∏π
            </div>
            <div class="title-text-main">ËßÄÂ§©Â±Ä</div>
          </div>
          <div class="title-sub-row">
            <div class="title-sub-zh">‰ª•‰ªäËßÄÂ§© ¬∑ ‰ª•ÊôÇ‰øÆË∫´</div>
            <div class="title-sub-en">Dan Dao ¬∑ Weather & Almanac</div>
          </div>
        </div>

        <div class="header-meta">
          <div class="city-tag">
            <span class="city-dot"></span>
            <span>ÂòâÁæ© ¬∑ ÊìáÊó•ËßÄÂ§©</span>
          </div>
          <div class="date-line">
            <div class="date-label">‰ªä Êó• ÊõÜ</div>
            <div class="date-value" id="headerDate"></div>
          </div>
          <button class="refresh-btn" id="refreshBtn">
            Á∫å Âïè ‰ªä Êó• Â§© ‰æØ
          </button>
        </div>
      </header>

      <section id="loadingState" class="loading-overlay">
        <div class="loading-orb">
          <div class="loading-orb-inner">‚òØÔ∏è</div>
        </div>
        <div class="loading-text-main">Ê∞£ Ë±° Âç†</div>
        <div class="loading-text-sub">
          Ê≠£Ëàá‰∏≠Â§ÆÊ∞£Ë±°ÁΩ≤Êé•ËªåÔºå<br />
          Ë´ãÁ®çÂÄôÁâáÂàªÔºåÂæÖÂç¶Ë±°ÊàêÂΩ¢„ÄÇ
        </div>
        <div class="loading-hint">
          <span>‰æùÊìö CWA ‰ªäÊòé 36 Â∞èÊôÇÈ†êÂ†± ¬∑ ÁµêÂêàÁØÄÊ∞£Ë™øÊîù</span>
        </div>
      </section>

      <section id="mainContent" class="main-content">
        <article id="heroCard" class="hero-card">
          <!-- JS ÂãïÊÖãÂ°´ÂÖ• -->
        </article>

        <section class="section-wrapper">
          <div class="section-inner">
            <div class="section-heading">
              <div class="section-heading-label">ÊôÇ‰ª§È£ü‰øÆ</div>
              <div class="section-heading-line"></div>
            </div>
            <div id="solarSection"></div>
          </div>
        </section>

        <div id="errorArea"></div>

        <section class="section-wrapper">
          <div class="section-inner">
            <div class="section-heading">
              <div class="section-heading-label">Á®çÂæåÂ§©Ë±°</div>
              <div class="section-heading-line"></div>
            </div>
            <div class="scroll-container" id="futureForecasts"></div>
          </div>
        </section>
      </section>

      <footer class="app-footer">
        <div class="footer-left">
          <div class="footer-line">
            <div class="footer-dot"></div>
            <div class="footer-label">Ë≥á Êñô ‰æÜ Ê∫ê</div>
          </div>
          <div class="footer-source">
            ‰∏≠Â§ÆÊ∞£Ë±°ÁΩ≤ CWA ¬∑ ‰ªäÊòé 36 Â∞èÊôÇÂ§©Ê∞£È†êÂ†± + Ëá™Ë£ΩÁØÄÊ∞£È£≤È£üÂª∫Ë≠∞
          </div>
        </div>
        <div class="footer-right">
          <div class="footer-tn">Tainan / Chaiyi</div>
          <div class="footer-en">Weather & Almanac</div>
        </div>
      </footer>
    </div>
  </main>

  <script>
    const API_URL = "https://weather-sp.zeabur.app/api/weather/kaohsiung";
    // Êú¨Ê©üÊ∏¨Ë©¶ÂèØÊîπÁÇ∫Ôºö
    // const API_URL = "http://localhost:3000/api/weather/kaohsiung";

    function getWeatherIcon(weather) {
      if (!weather) return "‚õÖ";
      if (weather.includes("Â§öÈõ≤")) return "‚õÖ";
      if (weather.includes("Êô¥")) return "‚òÄÔ∏è";
      if (weather.includes("Èô∞")) return "‚òÅÔ∏è";
      if (weather.includes("Èõ∑")) return "‚õàÔ∏è";
      if (weather.includes("Èõ®")) return "üåßÔ∏è";
      return "‚õÖ";
    }

    function getAdvice(rainProb, maxTemp) {
      const rain = parseInt(rainProb, 10) || 0;
      const maxT = parseInt(maxTemp, 10) || 0;

      let rainIcon = "üíß";
      let rainText = "Èõ®Èú≤Âπ≥ÂíåÔºåÂèØÂÆâÂøÉÂá∫Ë°å";
      if (rain >= 70) {
        rainIcon = "‚õàÔ∏è";
        rainText = "Â§ßÈõ®Â∞áËá®ÔºåÂÆúÂÇôÂÇòËàáÈõ®ÂÖ∑";
      } else if (rain >= 40) {
        rainIcon = "üå¶Ô∏è";
        rainText = "ÊàñÊúâÈô£Èõ®ÔºåÂá∫ÈñÄÂÆúÂÇôÂÇò";
      } else if (rain >= 20) {
        rainIcon = "üå§Ô∏è";
        rainText = "Èõ≤ÈñìÊàñÊúâÈõ®Áµ≤ÔºåÁïôÊÑèÂ§©Ëâ≤";
      }

      let clothIcon = "üß•";
      let clothText = "Ë°£ËëóÈö®Ê∫´ËΩâÊèõ";

      if (maxT >= 28) {
        clothIcon = "üéΩ";
        clothText = "ÈôΩÊ∞£ÂÅèÁõõÔºåÂÆúËñÑË°£";
      } else if (maxT <= 20) {
        clothIcon = "üß•";
        clothText = "ÂØíÊ∞£ÂæÆÈõÜÔºåÂÆúÂä†Â§ñË°£";
      }

      return { rainIcon, rainText, clothIcon, clothText, rain, maxT };
    }

    function getTimePeriod(startTime) {
      const hour = new Date(startTime).getHours();
      if (hour >= 5 && hour < 11) return "Êô®ÂÖâÊú™Â§Æ";
      if (hour >= 11 && hour < 14) return "Êó•Ê≠£Áï∂Âçà";
      if (hour >= 14 && hour < 18) return "ÂçàÂæåÂ§©ÂÖâ";
      if (hour >= 18 && hour < 22) return "ÈªÉÊòèÂÖ•Â§ú";
      return "Â≠êÂ§úÁÑ°ËÅ≤";
    }

    function formatTime(str) {
      const d = new Date(str);
      const h = d.getHours().toString().padStart(2, "0");
      const m = d.getMinutes().toString().padStart(2, "0");
      return `${h}:${m}`;
    }

    function showError(message) {
      const errorArea = document.getElementById("errorArea");
      errorArea.innerHTML = `
        <div class="error-card">
          <div class="error-title">Âç¶Ë±°ÂèóÈòª</div>
          <div class="error-body">
            ${message}<br/>
            Âª∫Ë≠∞Á®çÂæåÂÜçË©¶ÔºåÊàñÊ™¢Êü•Á∂≤Ë∑ØÁãÄÊÖã„ÄÇ
          </div>
        </div>
      `;
    }

    function clearDisplay() {
      document.getElementById("errorArea").innerHTML = "";
      document.getElementById("heroCard").innerHTML = "";
      document.getElementById("solarSection").innerHTML = "";
      document.getElementById("futureForecasts").innerHTML = "";
    }

    function renderWeather(data) {
      const forecasts = data.forecasts || [];
      if (!forecasts.length) return;

      const current = forecasts[0];
      const others = forecasts.slice(1);

      const advice = getAdvice(current.rain, current.maxTemp);
      const period = getTimePeriod(current.startTime);
      const maxT = parseInt(current.maxTemp, 10) || 0;
      const minT = parseInt(current.minTemp, 10) || 0;
      const avgTemp = Math.round((maxT + minT) / 2);

      const hero = document.getElementById("heroCard");
      hero.innerHTML = `
        <article class="hero-card">
          <div class="hero-inner">
            <div class="hero-header-row">
              <div class="hero-title-block">
                <div class="hero-title">‰ªä Êó• Â§© Ë±°</div>
                <div class="hero-subtitle">Current Sky over Kaohsiung</div>
              </div>
              <div class="hero-meta">
                <div class="hero-period-tag">${period}</div>
                <div class="hero-meta-line">
                  <span class="meta-label">ÊôÇ ÊÆµ</span>
                  <span class="meta-value">
                    ${formatTime(current.startTime)} ~ ${formatTime(current.endTime)}
                  </span>
                </div>
              </div>
            </div>

            <div class="hero-main">
              <div class="hero-icon-wrap">
                <div class="hero-icon">${getWeatherIcon(current.weather)}</div>
              </div>
              <div class="hero-temp-block">
                <div class="hero-temp">${avgTemp}¬∞</div>
                <div class="hero-weather-text">${current.weather || ""}</div>
                <div class="hero-range">Ê∫´Â∫¶ÂçÄÈñìÔºö${current.minTemp}¬∞ ~ ${current.maxTemp}¬∞</div>
              </div>
            </div>

            <div class="hero-advice-grid">
              <div class="advice-item">
                <div class="advice-title">Èõ®Èú≤Âç†</div>
                <div class="advice-main">
                  <span class="advice-icon">${advice.rainIcon}</span>
                  <span class="advice-desc">${advice.rainText}</span>
                </div>
                <div class="advice-sub">ÈôçÊ∞¥Ê©üÁéáÁ¥ÑÔºö${current.rain}</div>
              </div>

              <div class="advice-item">
                <div class="advice-title">Ë°£ËëóÂç†</div>
                <div class="advice-main">
                  <span class="advice-icon">${advice.clothIcon}</span>
                  <span class="advice-desc">${advice.clothText}</span>
                </div>
                <div class="advice-sub">ÊúÄÈ´òÊ∞£Ê∫´Á¥ÑÔºö${current.maxTemp}¬∞</div>
              </div>
            </div>
          </div>
        </article>
      `;

      // üîπÁØÄÊ∞£ËàáÈ£≤È£üÂç°ÁâáÔºàÁî±ÂæåÁ´ØÊèê‰æõÔºâ
      const solarInfo = data.solar;
      const dietInfo = data.diet;
      const solarSection = document.getElementById("solarSection");

      if (solarInfo && dietInfo) {
        solarSection.innerHTML = `
        <article class="solar-card">
          <div class="solar-header">
            <div class="solar-tag">ÊôÇ ‰ª§ ÁØÄ Ê∞£</div>
            <div class="solar-stamp">È£ü ‰øÆ</div>
          </div>
          <div class="solar-body">
            <div class="solar-term-line">
              <span class="solar-term-name">${solarInfo.term}</span>
              <span class="solar-term-note">Ôºà${solarInfo.season}‰ª§ ¬∑ ${solarInfo.note}Ôºâ</span>
            </div>
            <div class="solar-diet-main">È£≤È£üË¶ÅÈªûÔºö${dietInfo.main}</div>
            <div class="solar-diet-sub">${dietInfo.sub}</div>
          </div>
        </article>
      `;
      } else {
        solarSection.innerHTML = `
        <article class="solar-card">
          <div class="solar-body">
            <div class="solar-diet-main">Êö´ÁÑ°ÁØÄÊ∞£Ë≥áÊñôÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ</div>
          </div>
        </article>
      `;
      }

      // üîπÁ®çÂæåÈ†êÂ†±Â∞èÂç°Áâá
      const scrollContainer = document.getElementById("futureForecasts");
      let miniCardsHTML = "";

      const now2 = new Date();
      const todayYear = now2.getFullYear();
      const todayMonth = now2.getMonth();
      const todayDate = now2.getDate();

      others.forEach(f => {
        const fDate = new Date(f.startTime);
        let periodText = getTimePeriod(f.startTime);

        const isSameDay =
          fDate.getFullYear() === todayYear &&
          fDate.getMonth() === todayMonth &&
          fDate.getDate() === todayDate;

        if (!isSameDay) {
          periodText = "ÊòéÊó• ¬∑ " + periodText;
        }

        miniCardsHTML += `
          <article class="mini-card">
            <div class="mini-time">${periodText}</div>
            <div class="mini-icon-row">
              <div class="mini-icon">${getWeatherIcon(f.weather)}</div>
              <div class="mini-temp">${f.minTemp}¬∞ ~ ${f.maxTemp}¬∞</div>
            </div>
            <div class="mini-rain">üíß ÈôçÊ∞¥Ê©üÁéáÔºö${f.rain}</div>
          </article>
        `;
      });

      scrollContainer.innerHTML = miniCardsHTML;

      // Âè≥‰∏äËßíÊó•Êúü
      const nowHeader = new Date();
      const month = nowHeader.getMonth() + 1;
      const date = nowHeader.getDate();
      const weekday = ["Êó•", "‰∏Ä", "‰∫å", "‰∏â", "Âõõ", "‰∫î", "ÂÖ≠"][nowHeader.getDay()];
      document.getElementById("headerDate").textContent = `${month} Êúà ${date} Êó•Ôºà${weekday}Ôºâ`;
    }

    async function fetchWeather() {
      const loadingEl = document.getElementById("loadingState");
      const mainContent = document.getElementById("mainContent");
      const errorArea = document.getElementById("errorArea");

      loadingEl.style.display = "flex";
      mainContent.style.display = "none";
      errorArea.innerHTML = "";
      clearDisplay();

      try {
        const delayPromise = new Promise(resolve => setTimeout(resolve, 1500));
        const fetchPromise = fetch(API_URL).then(res => res.json());
        const [_, json] = await Promise.all([delayPromise, fetchPromise]);

        if (json.success) {
          renderWeather(json.data);
          loadingEl.style.display = "none";
          mainContent.style.display = "block";
        } else {
          throw new Error("API ÂõûÊáâÂ§±Êïó");
        }
      } catch (e) {
        console.error(e);
        loadingEl.style.display = "none";
        mainContent.style.display = "none";
        showError("ÁÑ°Ê≥ïÂèñÂæóÊ∞£Ë±°Ë≥áÊñôÔºåÂèØËÉΩÊòØÁ∂≤Ë∑ØÊàñ‰º∫ÊúçÂô®Êö´ÊôÇ‰∏çÈÄö„ÄÇ");
      }
    }

    window.addEventListener("scroll", () => {
      const y = window.scrollY || 0;
      document.body.style.backgroundPositionY = `${y * 0.18}px`;
    });

    document.addEventListener("DOMContentLoaded", () => {
      fetchWeather();
      const btn = document.getElementById("refreshBtn");
      btn.addEventListener("click", () => {
        fetchWeather();
      });
    });
  </script>
</body>

</html>
